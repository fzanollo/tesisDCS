\begin{proof}
	
(Idea:	Para probar $\WES \subseteq \WESS$ mostramos que un supervisor para un estado $s$ en $\WES$ 
	puede ser usado como un supervisor para $s$ en $\WESS$. Para $\LES \subseteq 
	\LESS$, asumimos que hay un estado $s \in \LES \setminus \LESS $. Llegamos a una contradicción mostrando que el supervisor que $s$ debe tener en
	$\unexploredToTop{\structure'}$ es también un supervisor para $s$ en $\unexploredToTop{\structure}$.)



Si $s \in \WES $ entonces existe un supervisor $\sigma$ para el problema de control $\unexploredToBottom{\structure}$. Sea $Z$ tal que $\structure \subseteq Z$. Demostraremos que $\sigma$ es un supervisor para $\unexploredToBottom{Z}$. Esto requiere dos condiciones según la Definición~\ref{def:control-problem}. La primera, que $\sigma$ es controlable, es trivial ya que los conjuntos de eventos controlables y no controlables no fueron cambiados. 

Para la segunda, nonblocking, primero mostramos que $\L^\sigma(\unexploredToBottom{Z}) = 
\L^\sigma(\unexploredToBottom{\structure})$. 

Si asumimos que $\L^\sigma(\unexploredToBottom{Z}) \not\subseteq \L^\sigma(\unexploredToBottom{\structure})$ y $w \in 
\L^\sigma(\unexploredToBottom{Z}) \setminus \L^\sigma(\unexploredToBottom{\structure})$, la corrida que verifica $w$ debe permanecer siempre en $Z$ o alcanzar eventualmente un estado $deadlock$ en $\unexploredToBottom{Z}$. En cualquier caso, sea $w_0$ el prefijo más largo en $\structure$. 
Sabemos que $w_0$ es un prefijo no vacío de $w$. Sea $\ell$ tal que $w_0.\ell$ es un prefijo de $w$. 
Por la definición de $\unexploredToBottom{\structure}$, $w_0.\ell$ alcanza un estado $deadlock$ en $\unexploredToBottom{\structure}$. Esto es una contradicción, ya que $\sigma$ es un supervisor para
$\unexploredToBottom{\structure}$. 

Para mostrar que $\L^\sigma(\unexploredToBottom{Z}) \supseteq \L^\sigma(\unexploredToBottom{\structure})$, asumimos que $w \in \L^\sigma(\unexploredToBottom{\structure})$. Si $w$ también está en $\L^\sigma(\structure)$ entonces debe pertenecer a $\L^\sigma(Z)$ y $\L^\sigma(\unexploredToBottom{Z})$. De otra forma, $w = w_0.\ell$ alcanza un estado $deadlock$ en $\unexploredToBottom{\structure}$. Como $w_0$ pertenece a $\L^\sigma(\structure)$, pertenecer también a $\L^\sigma(Z)$. Consideramos el estado $s$ alcanzado por  $w_0$ en $E$, debe tener una transición etiquetada como $\ell$ para justificar su inclusión en $\unexploredToBottom{\structure}$. En $Z$, el estado $s$ o tiene la transición y por lo tanto $w_0.\ell \in \L^\sigma(Z) \subseteq 
\L^\sigma(\unexploredToBottom{Z})$, o no tiene la transición, pero el estado en $\unexploredToBottom{Z})$ tiene una transición $\ell$ a un estado $deadlock$, por lo tanto $w_0.\ell \in 
L^\sigma(\unexploredToBottom{Z})$.

Ahora, sabiendo que $\L^\sigma(\unexploredToBottom{Z}) = 
\L^\sigma(\unexploredToBottom{\structure})$, procedemos a $nonblocking$. Sea una palabra $w \in 
\L^\sigma(\unexploredToBottom{Z})$ que no puede ser extendida con $w'$ tal que $w.w'$ se encuentra en $L^\sigma(\unexploredToBottom{Z})$ y alcanza un estado marcado de $\unexploredToBottom{Z}$. 
Como $w$ también se encuentra en $L^\sigma(\unexploredToBottom{\structure})$ entonces, como $\sigma$ es un supervisor para $\unexploredToBottom{\structure}$, existe un $w'$ tal que
$w.w' \in L^\sigma(\unexploredToBottom{\structure}) = L^\sigma(\unexploredToBottom{Z})$ y alcanza un estado marcado. Notar que la corrida para $w.w'$ siempre se encuentra en $\structure$, lo que significa que la corrida también está en $\unexploredToBottom{Z}$. Finalmente llegamos a una contradicción.\\

Para demostrar que $\LES \subseteq \LESS$, asumimos que existe un estado $s \in \LES \setminus \LESS$. Como $s \notin \LESS$, tiene un supervisor $\sigma$ en $\unexploredToTop{\structure'}$, pero $s \in \LES$ por lo que no puede existitr un supervisor válido $\sigma'$ para $s$ en $\unexploredToTop{\structure}$. Esto es falso, más aún, mostraremos que si $\sigma$ es un supervisor para $s$ en $\unexploredToTop{\structure'}$, entonces hay un supervisor válido $\sigma'$ para $s$ en cualquier $\unexploredToTop{Z}$ si $Z \subseteq \structure$.

$\sigma$ es un supervisor valido en $\unexploredToTop{\structure'}$, por lo que cualquier palabra en $\L^\sigma(\unexploredToTop{\structure'})$ puede ser extendida para alcanzar un estado marcado. Solo hay una cantidad finita de estados en  $\unexploredToTop{\structure'}$, por lo que deben existir $w'$ y $w''$ tal que $w.w'.w'' \in \L^\sigma(\unexploredToTop{\structure'})$, $w.w'$ llega a un estado marcado, y $w.w'.w''$ llega al mismo estado que $w.w'$.

Si $w.w'.w''$ está en $\L^\sigma(Z)$, entonces no hay nada que hacer, es claro que $\sigma$ tiene la misma forma de extender $w$ en $\unexploredToTop{Z}$. Si no, notemos que $w.w'.w'' = w_0.l.w_1$ tal que $w_0$ es el prefijo más largo de $w.w'.w''$ en $\L^\sigma(Z)$, esto significa que $w_0.l$ alcanza el estado marcado ganador $\top$, y desde ahí toda extensión de la palabra solo puede permanecer en ese mismo estado, por lo tanto, $\sigma$ también es un controlador válido en  $\unexploredToTop{Z}$.
 
\begin{flushright}
$\square$
\end{flushright}

\end{proof}


\begin{proof}
	(Idea: Si $s$ no es un predecesor de $e'$, como $e \step{l}{\structure'} e'$ es la única diferencia entre $\structure$ y $\structure'$, entonces los decendientes de $s$ son los mismos, 
	por lo tanto sus posibles supervisores en $\unexploredToTop{\structure'}$ y
	$\unexploredToBottom{\structure'}$ no cambiaron. Entonces, $s \notin \WESS \cup 
	\LESS$ lo cual es una contradicción.
	
	Como paso siguiente probamos que hay al menos un camino desde $s$ a $e'$ a través de estados $\NONE$ por contradicción asumiendo que todos los caminos a $e'$ en $\structure'$ atraviesan un estado $s' \in 
	(\WES \cup \LES)$. Un supervisor $\sigma$ de $s$ en 
	$\unexploredToTop{\structure}$ no va a alcanzar estados en $\LES$, 
	por lo tanto todo $s'$ que alcance va a tener un supervisor $\sigma_{s'}$ para 
	$\unexploredToBottom{\structure}$. Usamos $\sigma$ y $\sigma_{s'}$ para construir un supervisor para $s$ en $\unexploredToTop{\structure'}$ para mostrar que $s 
	\not\in \LESS$.
	Un supervisor para $s$ en $\unexploredToBottom{\structure'}$ no puede existir porque de otra forma podríamos usarlo para construir un supervisor para $s$ en 
	$\unexploredToBottom{\structure}$ usando un razonamiento similar al anterior. Esto significa que $s \in 
	\WES$ contradiciendo la hipótesis. )


If a state $s$ is not in $\WES \cup \LES$ it is because it has a  supervisor $\sigma$ in $\unexploredToTop{\structure}$ but it doesn't have one in $\unexploredToBottom{\structure}$. This depends entirely on the descendants of $s$, since those are the only states that $\sigma$ can reach. If $s$ is not a predecessor of $e'$, and $e \step{l}{\structure'} e'$ is the only difference between $\structure$ and $\structure'$ then the descendants of $s$ are the same, thus its possible supervisors haven't changed, and $s$ is still NONE.

What is not so clear, is that $s$ has no new possible supervisors if it has a path to reach $e'$ but only by passing through at least one state in $\WES \cup \LES$. Assuming it must pass through states in $\WES \cup \LES$ we show that:

\begin{itemize}
	\item knowing $s$ had a supervisor $\sigma$ in $\unexploredToTop{\structure}$, we show $s$ has a valid supervisor $\sigma'$ in $\unexploredToTop{\structure'}$:
	
	$\sigma'(w) = \sigma(w)$ if there is no $w_0$ suffix of $w$ such that $ s \runw{w_0}{\structure'} s_i \wedge s_i \in \LES \cup \WES$. 
	
	$\sigma'(w) = \sigma_{s_i}(w_1)$ where $w_0$ is the shortest suffix of $w = w_0.w_1$ such that $ s \runw{w_0}{\structure'} s_i \wedge s_i \in \WES$. $\sigma_{s_i}$ is the supervisor we know $s_i$ had in $\unexploredToBottom{\structure}$ because $s_i \in \WES$, and every supervisor valid in $\unexploredToBottom{\structure}$ is also valid in $\unexploredToTop{\structure}$.
	
	Since $\sigma$ is a valid supervisor, we know it will not reach states in $\LES$.
	
	Finally it is clear that $\sigma'$ is a valid supervisor for $s$ in $\unexploredToTop{\structure'}$. Note that $\sigma'$ does not depend of the new transition.
	
	
	
	
	\item Knowing $s$ had no supervisor in $\unexploredToBottom{\structure}$, we show that $s$ has no supervisor in $\unexploredToBottom{\structure'}$ by assuming there is one and reaching a contradiction:
	
	Suppose there is a supervisor $\sigma'$ for $s$ in $\unexploredToBottom{\structure'}$, and that $e \step{l}{\structure'} e'$ is the only difference between $\structure$ and $\structure'$.
	
	With $\sigma'$ we will build $\sigma$, a supervisor for $s$ in $\unexploredToBottom{\structure}$.
	
	$\sigma(w) = \sigma'(w)$ if there is no $w_0$ which is a prefix of $w$ and $s \runw{w_0}{\structure} s_i \wedge s_i \in \WES \cup \LES$. Since $\sigma'$ is a valid supervisor, we know it will not reach states in $\LESS$. Note that $w$ can't reach $e \step{\l}{\structure'} e'$ because $s$ has no path of $\NONE$ states to $e'$.
	
	If $w=w_0.w_1$ and $s \runw{w_0}{\structure} s' \wedge s' \in \WES$ then $\sigma(w_0.w_1) = \sigma_{s'}(w_1)$ where $\sigma_{s'}$ is the supervisor for $s'$ in $\unexploredToBottom{\structure}$. Note that once we reach $s'$ we always follow $\sigma_{s'}$.
	
	Since $\sigma$ never reaches the new transition we know that $\sigma$ is valid in $\unexploredToBottom{\structure}$.
		
	We see then that assuming there is a valid supervisor $\sigma'$ for $s$ in $\unexploredToBottom{\structure'}$ implies that there is a valid supervisor $\sigma$ for $s$ in $\unexploredToBottom{\structure}$. ABS! \\
	
\end{itemize}
\begin{flushright}
	$\square$
\end{flushright}
\end{proof}

\begin{proof}
	(Idea: Asumiendo $e' \notin \WESS$, usamos un testigo $s$ de $\WESS \neq 
	\WES$ para llegar a una contradicción. El estado $s$ debe tener un supervisor en 
	$\WESS$ que evita $e \step{\l}{} e'$, la única diferencia entre $\unexploredToBottom{\structure}$ y $\unexploredToBottom{\structure'}$. Este supervisor entonces es también un supervisor para $s$ en $\WES$ llegando a un absurdo. 
	
	Si asumimos $e' \notin \LESS$.  usamos un testigo $s$ de $\LESS \neq \LES$ para llegar a una contradicción. Notar que como $e' \notin \LESS$, hay un supervisor $\sigma$ desde $e'$ en  
	$\unexploredToTop{\structure'}$. Como $s \notin \LES$ también debe haber un supervisor $\sigma'$ en $\unexploredToTop{\structure}$. Construimos un nuevo supervisor para $\unexploredToTop{\structure'}$ desde $s$ que funciona exactamente como $\sigma'$ pero cuando alcanza $e \step{\l}{} e'$ se comporta como $\sigma$. Este nuevo supervisor prueba que $s \in \LESS$ lo cual es una contradicción.)


We prove both implications by contradiction. 

First we assume $e' \not\in 
\WESS \setminus \WES$. Note that as $e' \notin \WES$ then $e' 
\notin 
\WESS$.  As $\WESS \neq \WES$ by monotonicity 
(Lemma\ref{lem:WESandLesMonotonicity}) there must be a state $s$ 
such that $s \in \WESS \setminus 
\WES$, so $s$ must have a supervisor in $\WESS $. This supervisor 
cannot reach $e'$ because if it did, 
then there would be a supervisor for $e'$ and we had assumed $e' 
\notin \WESS$. Furthermore, if the supervisor reaches $e$, then 
$\l$ 
must be controllable (it if were uncontrollable, the supervisor would 
reach $e'$ which we established is not possible). Thus, the 
supervisor 
avoids $e \step{\l}{} e'$ altogether which means that it is also a 
supervisor for $s$ in $\unexploredToBottom{\structure}$ (i.e.,  $s 
\in 
\WES$) reaching a contradiction.

Now we assume $e' \not\in 
\LESS \setminus \LES$. Note that as $e' \notin \LES$ then $e' 
\notin 
\LESS$.  
 Let $s \in \LESS$ and $s \not\in \LES$. We know that from $s$ 
 there is a supervisor $\sigma'$ for 
 $\unexploredToTop{\structure}$. This supervisor either is also a 
 supervisor for $\structure$ or reaches the $\top$ state in 
 $\unexploredToTop{\structure}$. In the first case, it is also a 
 supervisor $\structure'$ and in $\unexploredToTop{\structure'}$, 
 reaching a contradiction. In the second case, it either uses a 
 transition that is neither in $\structure'$ nor $\structure$, which 
 means that in $\unexploredToTop{\structure'}$ it will lead to a 
 winning $\top$ state; or it uses the transition that is in 
 $\structure'$ but not $\structure$ which leads to $e'$. Since we 
 know $e'$ is not in $\LESS$, then it has a supervisor for it in 
 $\unexploredToTop{\structure'}$, then we know that there exists a 
 supervisor $\sigma''$ that includes both $\sigma'$ and the 
 supervisor for $e'$. Finally, $\sigma''$ is a supervisor for $s$ in 
 $\unexploredToTop{\structure'}$, but $s \notin \LESS$, ABS!	
\begin{flushright}
	$\square$
\end{flushright}
\end{proof}

\begin{proof}
	(Idea: Para probar que $e' \in \WESS \setminus \WES$ implica \texttt{canBeWinningLoop($\SCC$)}, asumimos \\ $\neg$\texttt{canBeWinningLoop($\SCC$)} y mostramos que $e' \notin \WESS 
	\setminus \WES$. Para esto, basta con ver que si
	$\neg$\texttt{canBeWinningLoop($\SCC$)} entonces para alcanzar un estado marcado desde $e'$ se debe salir de $\SCC$ a un estado $s \notin \SCC \cup \WES$ lo que implica $s \notin \WESS$ 
	ya que $s$ no tiene ningún camino de estados none que llegue a $e \step{\l}{} e'$  (Lemma~\ref{lem:newWinnersLosersAreNonePredecessors}).
	Como $s$ no tiene supervisor en $\unexploredToBottom{\structure'}$, es imposible que $e'$ tenga uno. 
	
	Para probar que \texttt{canBeWinningLoop($\SCC$)} implica $e' \notin \LESS$ construimos un supervisor $\sigma'$ para $e'$ en $\unexploredToTop{\structure'}$ de la siguiente forma:
	Para una traza que se quede dentro de $\SCC$, solo elegimos sucesores controlables que no estén en $\LES$. Notar que no puede haber sucesores no controlables en $\LES$ ya que
	$\SCC \cap \LES= \emptyset$. Tan pronto como la traza sale de $\SCC$ a un estado $s'$ usamos el supervisor para $s'$ en $\unexploredToTop{\structure'}$. 
	Como $s'$ no puede alcanzar $e \step{\l}{\structure'} 
	e'$ usando estados $\NONE$, por el 
	Lemma~\ref{lem:newWinnersLosersAreNonePredecessors}, $s'$ debe tener el supervisor que necesitamos.)	


Supose $e' \in \WESS \setminus \WES$ but $\neg$\texttt{canBeWinningLoop($\SCC$)}.
There exists a supervisor $\sigma$ for $e'$ in $\unexploredToBottom{\structure'}$, this means there must be a path $w$ from $e'$ to a marked state $m$. 
Since $\neg$\texttt{canBeWinningLoop($\SCC$)}, there are no marked state in $\SCC$, $w$ must leave $\SCC$. 
Let $s$ be the first state reached by $w$ not in $\SCC$, $s$ is in $\LES \cup \NONE$, and doesn't have a $\NONE$ path to $e'$ then by Lemma~\ref{lem:newWinnersLosersAreNonePredecessors} $s$ will still not change it status.
Since $s \notin \WESS$, $s$ doesn't have a supervisor in $\unexploredToBottom{\structure'}$, but $\sigma$ accepts runs that lead to $s$, absurd.



Assuming \texttt{canBeWinningLoop($\SCC$)} we simply build a supervisor $\sigma^4$ for $e'$ in $\unexploredToTop{\structure'}$ to prove that $e' \notin \LESS$


We define $\sigma^4$ so that it enables all uncontrollable transitions (to be $controllable$).

$\sigma^4(w_0.w_1) = \sigma_{s'}(w_1)$ if $w_0$ is the shortest word such that there is an $s' \notin \SCC \wedge s'\notin \LES$ and $e' \runw{w_0}{\unexploredToTop{\structure'}} s'$.
Else if $e' \runw{w}{\unexploredToTop{\structure'}} p \wedge p \in \SCC$ then for all controllable $\l'$, $\l' \in\sigma^4(w)$ iff $\exists  p' \ldot p \step{l'}{} p' \wedge p' \notin \LES$.
%todas las transiciones que van al loop mas todas las transiciones que salen a un estado NONE (o TOP), i.e. no error. 

We use the supervisors $\sigma_{s'}$ where $s'$ is such that exists $s \in \SCC$ and $s\step{\l'}{\unexploredToTop{\structure'}} s'\wedge s' \notin \SCC \wedge s'\notin \LES$. If none such $s'$ exists, we know there is a marked state in $\SCC$ and $\sigma^4$ never leaves $\SCC$ since all reachable states from $\SCC$ are in $\LES$.



We will prove that $\sigma^4$ is $controllable$ and $non-blocking$.

Since we enabled all uncontrollable transitions, $\sigma^4$ is trivially $controllable$.

For $non-blocking$, assume $w$ compatible with $\sigma^4$, we will show that it can be extended. If $w = w_0.w_1$ where $w_0$ is the shortest word such that there is an $s' \notin \SCC \wedge s' \notin \LES$ and $e' \runw{w_0}{\unexploredToTop{\structure'}} s'$. Then by definition of $\sigma^4$ we have that $\sigma^4(w_0.w_1.w_2) = \sigma_{s'}(w_1.w_2)$ for all $w_2$. As $\sigma_{s'}$ is $non-blocking$, there is a $w_2$ such that $\sigma_{s'}(w_1.w_2)$ hits a marked state. So $\sigma^4(w_0.w_1)$ can be extended to hit the marked state. 

Otherwise, $w$ never exits $\SCC$. We want to prove that for every $\l'$ such that $w.\l'$ is consistent with $\sigma^4$, $w.\l'$ is extendable with a $w'$ to reach a marked state. Let $p'$ be such that $e' \runw{w.\l'}{} p'$. If $p' \notin \SCC$ then $\sigma^4(w.\l') = \sigma_{p'}(\lambda)$ and, as before, we know $\sigma_{p'}$ is $non-blocking$ so $w.l'$ is extendable to reach a marked state.\\
If $p' \in \SCC$, then  $w.l'$ can be extended to reach any state $s$ in the $\SCC$. We know that either there is a marked state in $\SCC$ or a state in $\WES$ reachable in one step from $\SCC$, either way we can extend $w.l'$ to reach a marked state.\\
\begin{flushright}
	$\square$
\end{flushright}
\end{proof}


\begin{proof}
	(Idea: Dividimos la prueba según la estructura del  if/then/else de \texttt{findNewErrorsIn}. 
	En el caso de que el \texttt{if} sea true, es suficiente probar que $e' \notin \LESS$. Para esto, 
	construimos un supervisor $\sigma'$ para $e'$ en $\unexploredToTop{\structure'}$ de la siguiente forma: Para una traza que se queda dentro de $\SCC$, solo tomamos sucesores controlables que no estén en $\LES$. Notar que no puede haber sucesores no controlables en $\LES$ ya que
	$\SCC \cap \LES= \emptyset$. Tan pronto como la traza sale de $\SCC$ al estado $s'$ usamos el supervisor de $s'$ en $\unexploredToTop{\structure'}$. 
	Como $s'$ no puede alcanzar $e \step{\l}{\structure'} 
	e'$ usando estados $\NONE$, por el 
	Lemma~\ref{lem:newWinnersLosersAreNonePredecessors}, $s'$ debe tener tal supervisor. 
	
	Cuando el \texttt{if} es false, alcanza con probar que $P = \SCC \subseteq \LESS$. Alcanzamos una contradicción asumiendo que $s \in \SCC \setminus \LESS$: Si $s 
	\notin \LESS$ entonces tiene un supervisor $\sigma$ que acepta una traza $w$ alcanzando un estado marcado. Como no hay estados marcados en $\SCC$, $w$ alcanza un estado $s' \notin \SCC$. Como el
	\texttt{if} era false, $s' \in \LESS$ por lo que $\sigma$ no es un supervisor.)


First, we know that every state $s' \notin \SCC$ such that $\exists s \in \SCC \ldot s 
\step{l}{} s'$, either is and will be a losing state ($s' \in LES \wedge s' \in LESS$) or is 
and will be $\NONE$ (because $s$ isn't a $NONE-$Predecessor of any state in 
$\SCC$, otherwise $s$ would be in $\SCC$). \\
This means that any state $s' \notin \SCC \wedge s' \notin \LES$ can not be forced to a state in $\LESS$. Thus, if we reach a $\NONE$ state we know it has a supervisor $\sigma_{s'}$ in $\unexploredToTop{\structure'}$.

In the case that the $\texttt{if}$ statement is true, we prove that $e' \notin \LESS$:

We use the same $\sigma^4$ as in Proof Lemma \ref{lem:canBeWinningLoopWorks}. We already know $\sigma^4$ is both $controllable$ and $non-blocking$ in this situation because of the previos Lemma.\\

Otherwise we enter the $\texttt{else}$ block:

If $\nexists s \in \SCC \ldot \trimlst{s \step{\l'}{\unexploredToTop{\structure'}}  s'} \wedge (s' \notin \SCC \wedge s' \notin \Errors)$ we prove that $\forall s \in \SCC$, $s \in \LESS$

Suppose there is a supervisor $\sigma'$ for $s$ in $\unexploredToTop{\structure'}$ then $\exists w'$ such that $s \runw{\lambda.w'}{\unexploredToTop{\structure'}} e_m \wedge e_m \in M_{\unexploredToTop{\structure'}}$. Since there's no marked state in $\SCC$ then eventually $s$ following $w'$ leaves $\SCC$. \\
Let $w' = w_0.w_1$ such that $w_0$ is the shortest word so that $s \runw{w_0}{\unexploredToTop{\structure'}} s' \wedge s' \notin \SCC$. But since $s'\in \Errors \Rightarrow s' \in \LES$ then it is not possible for a valid supervisor $\sigma'$ to allow reaching that state. ABS! Then there's no supervisor for $s$ in $\unexploredToTop{\structure'}$ implying $\forall s \in \SCC$, $s \in \LESS$.
\begin{flushright}
	$\square$
\end{flushright}
\end{proof}